<!DOCTYPE html>
<html prefix="dc: http://purl.org/dc/terms/ og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# books: http://ogp.me/ns/books#" lang="en-AU">
	<head>
		<meta charset="UTF-8" />
		<title>The Durham Poems</title>
		<meta name="application-name" content="Durham Poems" />
		<link rel="manifest" type="application/manifest+json" href="manifest.webmanifest" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link href='//fonts.googleapis.com/css?family=Goudy+Bookletter+1911' rel='stylesheet' type='text/css' />
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0" />
		<script type="text/javascript" src="//maps.googleapis.com/maps/api/js?key=AIzaSyDQqDxv7wuWp8CeZNkIC-EtplXPLk7gp90"></script>
		<script type="text/javascript" src="./d3/d3.min.js"></script>
		<link rel="apple-touch-icon" href="./images/icon.png" />
		<link rel="apple-touch-icon" sizes="76x76" href="./images/icon-76x76.png" />
		<link rel="apple-touch-icon" sizes="120x120" href="./images/icon-120x120.png" />
		<link rel="apple-touch-icon" sizes="152x152" href="./images/icon-152x152.png" />
		<link rel="apple-touch-icon" sizes="167x167" href="./images/icon-167x167.png" />
		<link rel="apple-touch-icon" sizes="180x180" href="./images/icon-180x180.png" />

		<!-- check startup image use or remove / startup image not currently working in chrome-->
		<link rel="apple-touch-startup-image" href="./images/cover-960x1440.png" />
		<meta name="mobile-web-app-capable" content="yes" />
		<link rel="icon" sizes="192x192" href="./images/icon-192x192.png" />

		<!--
			apple: https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html 
		-->

		<meta name="apple-mobile-web-app-title" content="Durham Poems" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		
		<link rel="shortcut icon" type="image/x-icon" href="./images/favicon.ico" />

		<meta name="description" content="A series of poems on William Denton's early life in Darlington and Shildon covering the years 1823 to 1842." />

		<!-- Twitter Card -->
		<meta property="twitter:card" content="summary" />
		<meta property="twitter:title" content="The Durham Poems" />
		<meta property="twitter:site" content="@thecodeofthings" />
		<meta property="twitter:description" content="A series of poems concerning the early life of William Denton (1823–1883) in Darlington and Shildon covering the years 1823 to 1842." />
		<meta property="twitter:image" content="https://poetry.thecodeofthings.com/the-durham-poems/working/images/cover-1200x1200.png" />

		<!-- Open Graph -->
		<!-- issue with books without ISBNs
		<meta property="og:type" content="books.book" /> 
		<meta property="books:author" content="http://bl.id.au" /> -->
		<meta property="og:title" content="The Durham Poems" />
		<meta property="og:image" content="https://poetry.thecodeofthings.com/the-durham-poems/working/images/cover-2400x1260.png" />
		<meta property="og:url" content="https://poetry.thecodeofthings.com/the-durham-poems/working/" />
		<meta property="og:description" content="A series of poems concerning the early life of William Denton (1823–1883) in Darlington and Shildon covering the years 1823 to 1842." />

		<!-- Dublin Core -->
		<meta property="dc:title" content="The Durham Poems" />
		<meta property="dc:description" content="A series of poems concerning the early life of William Denton (1823–1883) in Darlington and Shildon covering the years 1823 to 1842." />
		<meta property="dc:identifier" content="https://poetry.thecodeofthings.com/the-durham-poems/working" />
		<meta property="dc:creator" content="Benjamin Laird" />
		<meta property="dc:publisher" content="The Code of Things" />
		<link rel="dc:type" href="http://purl.org/dc/dcmitype/InteractiveResource" />

		<!-- to do: generalise and clean up clear function (eg Tabula rasa), check positioning, check page number/TOC for acknowledgements etc., move functions into chapbook reader? alt text on images used in the chapbook, move poems into a json file, chrome icons, loading images, ServiceWorker cache, double check ipad issues, move fonts offline, standard preload for all images, fix length lookups in loops, add key page turn (left right arrows), splash screens, move and set mime type for webmanifest -->
		<link rel="canonical" href="https://poetry.thecodeofthings.com/the-durham-poems/working/" />
		<style type="text/css">

			* { -webkit-font-smoothing: subpixel-antialiased; } /* put somewhere sensible not needed? */
			html { height: 100%; position: fixed; width: 100%; background-color: #666; }
			body { background-color: #666; /* background-color: #000; */ padding:0; margin:0; height:100%; width:100%; overflow: hidden; } /* make body 100% / 100% > */
			h1 { font-family: 'Goudy Bookletter 1911', serif; color: #FFF; text-align: center; padding:10px 0 0; margin:0; vertical-align: middle; line-height: 20px; font-weight: normal; 
				-moz-user-select: none;
				-khtml-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				user-select: none; cursor:default;}
			svg { position:absolute; top:0; left:0; height:auto; min-width:100%; }
			
			svg text::-webkit-selection { background: transparent; }
			svg text::-moz-selection { background: transparent; }
			svg text::selection { background: transparent; }
			
			svg tspan::-webkit-selection { background: transparent; }
			svg tspan::-moz-selection { background: transparent; }
			svg tspan::selection { background: transparent; }

			svg path::-webkit-selection { background: transparent; }
			svg path::-moz-selection { background: transparent; }
			svg path::selection { background: transparent; }

			svg textPath::-webkit-selection { background: transparent; }
			svg textPath::-moz-selection { background: transparent; }
			svg textpath::selection { background: transparent; }

			/* alter so that there is selection on inputs */
			::-webkit-selection { background: transparent; }
			::-moz-selection { background: transparent; }
			::selection { background: transparent; }

			textarea, input { outline: none; }
			input::-webkit-selection, textarea::-webkit-selection { background-color: #DDD; }
			input::-moz-selection, textarea::-moz-selection { background-color: #DDD; }
			input::selection,  textarea::selection { background-color: #DDD; }

			/* *::-webkit-selection { background: none; }
			*::-moz-selection { background: none; }
			*::selection { background: none; } */

			img { /* stop selection highlight */
				pointer-events: none;
				-moz-user-select: none;
				-khtml-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			.link-verso, .link-recto {
				/*stroke: #000;
				stroke-width:2px;*/
				pointer-events: none;
				-moz-user-select: none;
				-khtml-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			.imprint, .inter-title, .quote {
				font: 10px 'Goudy Bookletter 1911';
				pointer-events: none;
			}
			.quote-author {
				font: 10px 'Goudy Bookletter 1911';
				font-style: italic;
				pointer-events: none;
			}
			.node-verso text, .node-recto text {
				font: 12px 'Goudy Bookletter 1911';
				cursor: move;
			}
			.acknowledgements {
				font: 12px 'Goudy Bookletter 1911';
				pointer-events: none;
			}
			.text, .folio, #sub-alternate-title, #publisher, #year, .contents-poem-title, .contents-poem-page-number {
				font: 12px 'Goudy Bookletter 1911';
				pointer-events: none;
			}
			.header, #author, #place, #contents-title, .acknowledments-title {
				font: 14px 'Goudy Bookletter 1911';
				pointer-events: none;
			}
			#main-alternate-title {
				font: 16px 'Goudy Bookletter 1911';
				pointer-events: none;
			}
			#main-pre-title {
				font: 20px 'Goudy Bookletter 1911';
				pointer-events: none;
			}
			#main-title {
				font: 28px 'Goudy Bookletter 1911';
				pointer-events: none;
			}
			#poems {
				width: 1266px;
				height: 752px;
				margin: 0;
		      -webkit-perspective: 50000px;
		         -moz-perspective: 50000px;
		           -o-perspective: 50000px;
		              perspective: 50000px;
				box-sizing: border-box;
				-moz-box-sizing: border-box;
				-webkit-box-sizing: border-box; }

			.page { height:750px;width:600px;
				/* border:1px solid red; */
				z-index:0;
				border:1px solid #000;
				/* border-left:none; */
				position: absolute;
				top:0;
				right:31px;
				/* overflow: hidden; */
				background-color: #EEE;
				/* box-sizing: border-box;
				-moz-box-sizing: border-box;
				-webkit-box-sizing: border-box; */
      -webkit-transition: -webkit-transform 0.5s linear;
         -moz-transition: -moz-transform 0.5s linear;
           -o-transition: -o-transform 0.5s linear;
              transition: transform 0.5s linear;
		-webkit-transform: rotateY( 0deg ) translateZ(-0.01px); /* translateZ set to -0.01px to stop a Safari flicker issue */
		 -moz-transform: rotateY( 0deg ) translateZ(-0.01px);
		   -o-transform: rotateY( 0deg ) translateZ(-0.01px);
		      transform: rotateY( 0deg ) translateZ(-0.01px);
	     -webkit-transform-style: preserve-3d;
         -moz-transform-style: preserve-3d;
           -o-transform-style: preserve-3d;
              transform-style: preserve-3d;

			}
			#poems .page { 

	     -webkit-transform-origin: left center; 
         -moz-transform-origin: left center; 
           -o-transform-origin: left center; 
              transform-origin: left center; 

			}
			#poems .page.turned {
				z-index: 1;
				-webkit-transform: rotateY( -180deg ) translateZ(0.01px); /* translateZ set to -1px to stop a Safari flicker issue / Opx doesn't work -- maybe actual number forces acceleration  */
				 -moz-transform: rotateY( -180deg ) translateZ(0.01px);
				   -o-transform: rotateY( -180deg ) translateZ(0.01px);
				      transform: rotateY( -180deg ) translateZ(0.01px);
			}
			#poems .page.turning {
				z-index: 2;
			}

			#poems .recto-poem,
			#poems .verso-poem {
				background-color:#EEE;
				height:750px;
				width:600px; 
				position: absolute;

		      -webkit-transform-style: preserve-3d;
		         -moz-transform-style: preserve-3d;
		           -o-transform-style: preserve-3d;
		              transform-style: preserve-3d;
				
				-webkit-backface-visibility: hidden;
				-moz-backface-visibility: hidden;
				-o-backface-visibility: hidden;
				backface-visibility: hidden;

			}
			#poems * { /* fix a strange artifact bug -- bottom lefthand square on verso pages during transitions */
				background-color: transparent;
			}

			.page .recto-poem {

			}

			#poems .page .verso-poem {

      -webkit-transform: rotateY( 180deg );
         -moz-transform: rotateY( 180deg );
           -o-transform: rotateY( 180deg );
              transform: rotateY( 180deg );
			}

			#poems .pages {
				width:45px;
				height: 750px;
				background-color: #EEE;
				float:left;
				
				box-sizing: border-box;
				-moz-box-sizing: border-box;
				-webkit-box-sizing: border-box; 
			}
			#poems .recto {
				background-image: linear-gradient(to right, #000 0%, #EEE 100%);
				position: absolute;
				top: 0;
				left: -1px;
			}
			#poems .verso {
				background-image: linear-gradient(to left, #000 0%, #EEE 100%);
				position: absolute;
				top: 0;
				right: -1px;
			}
			#featured-image {
				width: 70%;
				height: auto;
				position:absolute;
				top:25%;
				left:15%;
			}
			#featured-image::selection { background: none; }

			#previous-page, #next-page {
				width:28px;
				height:750px;
				border:1px solid #000;
				display: block;
				text-decoration: none;
				color:#000;
				cursor: pointer;
			}
			#poems #previous-page {
				background: #FFF url("./images/previous-pages.png") repeat top right;
				background-size: 72px auto;
				border-right:none;
				
				position:absolute;
				top: 0;
				left: 3px;
			}
			#poems #next-page {
				background: #FFF url("./images/next-pages.png") repeat top left;
				background-size: 72px auto;
				border-left:none;
				
				position:absolute;
				top: 0;
				right: 3px;
			}

			#poems #previous-page:link, #poems #next-page:link {
				background-color: #333;
				color: #000;
			}
			#poems #previous-page:focus, #poems #next-page:focus,
			#poems #previous-page:hover, #poems #next-page:hover,
			#poems #previous-page:active, #poems #next-page:active {
				background-color: #CCC;
				color: #FFF;
			}
			#poems #previous-page span, #poems #next-page span {
				display:block; 
				float:none;
				background-color: transparent;
				height:750px;
				width:100%;				
				/* support of user-select problematic? */
				-moz-user-select: none;
				-khtml-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			#poems .verso-poem.no-page { background-color: #000; }
			#poems .verso-poem.no-page .pages, #poems .verso-poem.no-page .verso { background-color: #000; background-image: none; }

			header { height: 37px; background-color: #000; z-index: 10;
				position:absolute; top:0; left:0; width:100%; 
				transition: top 1s;
				box-sizing: border-box;
				-moz-box-sizing: border-box;
				-webkit-box-sizing: border-box; }

			menu { height: 37px; background-color: #000; 
				position:absolute; bottom:0; left:0; width:100%; 
				transition: bottom 1s;
				box-sizing: border-box;
				-moz-box-sizing: border-box;
				-webkit-box-sizing: border-box;
				-moz-user-select: none;
				-khtml-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			#fullscreen, #previous-control, #next-control, #single-page, #double-page, #about, #share, #close-modal, #play-pause { cursor: pointer; }

			#play-pause { position:absolute; right: 270px; top:5px;}
			button img { height: 25px; width:auto; border:none; }

			button::-moz-focus-inner { /* remove extra padding from Firefox */
				padding: 0;
				border: 0
			}

			#about {
				position:absolute; right: 315px; top:5px;
				height: 25px; width: 25px;
				border: 2px solid #FFF;
				box-sizing: border-box;
				-moz-box-sizing: border-box;
				-webkit-box-sizing: border-box;				
				font-family: 'Goudy Bookletter 1911', serif;
				text-align: center;
				border-radius: 50%;
				font-size: 1.4em;
				line-height: 0.8em;
				vertical-align: top;
			}
			#about abbr {
				text-decoration: none;
			}

			#share { position:absolute; right: 235px; top:5px;}
			/* #share img { height: 25px; width:auto; } */

			#close-modal { position:absolute; right: 0; top:0; }
			#close-modal img { height: 20px; width:auto; }

			#single-page { position:absolute; right: 200px; top:5px; }
			/* #single-page img {height: 25px; width: auto; } */
			#double-page  { position:absolute; right: 150px; top:5px; }
			/* #double-page img { height: 25px; width:auto; } */
			#fullscreen { position:absolute; right: 110px; top:5px;}
			/* #fullscreen img { height: 25px; width:auto; }  */
			
			#previous-control { position:absolute; right: 70px; top:5px; }
			/* #previous-control img { height: 25px; width:auto; } */

			#next-control { position:absolute; right: 30px; top:5px; }
			/* #next-control img { height: 25px; width:auto; } */
			
			button { padding:1px; margin: 0; border: none; background-color: transparent; color:#FFF; display:block; height:25px; box-sizing: content-box;
				-moz-box-sizing: content-box;
				-webkit-box-sizing: content-box; min-width: 25px; text-align: center; }
			button:focus { outline: none; }
			button:hover, button:active { outline: none; opacity:0.5; } 

			a:link, a:visited {
				color:#000;
			}
			a:focus, a:hover, a:active { 

			}
			#double-page[disabled="disabled"], #single-page[disabled="disabled"] {
				opacity: 0.5;
				cursor: default;
			}

			#controls-tab { position:absolute; width:40px; height: 10px; background-color: #444; bottom:37px; right:70px; overflow:hidden; border-radius: 5px 5px 0 0; transition: bottom 1s, height 1s, opacity 1s; opacity:0.6;
				-moz-user-select: none;
				-khtml-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				user-select: none; }
			#controls-tab:hover { height:25px; opacity:1;}
			#controls-switch { padding:0; display:block; height:25px; width:40px; cursor: pointer; }
			#controls-switch img { width: 30px; height: auto; padding:5px; }

			.without-controls header { top:-37px; }
			.without-controls menu { bottom:-37px; }
			.without-controls #controls-tab { bottom: 0; }

			menu { list-style-type: none; padding: 0; margin: 0; }
			menu li { padding: 0; margin: 0; }

			#modal-screen {
				position:absolute; 
				z-index: 50;
				background-color: #000;
				width:100%;
				height: 100%;
				opacity: 0.5;
			}

			#modal-panel {
				position:absolute; 
				z-index: 100;

				width:420px;
				height:230px;
				
				background-color: #DDD;
				background-color: #EEE;
				color:#000;
				top: 50%;
				-webkit-transform: translateY(-50%);
				-moz-transform: translateY(-50%);
				-o-transform: translateY(-50%);
  				transform: translateY(-50%); /* add specific */
				margin-left: auto;
				margin-right: auto;
				left: 0;
				right: 0;
				border: 10px solid #000;
				border-radius: 5px;
				overflow: hidden;
			}
			#modal-panel h2 {
				background-color: #000;
				color:#FFF;
				font-family: 'Goudy Bookletter 1911', serif;
				margin: 0;
				padding: 0 0 5px 0;
				line-height: 1em;
				font-weight: normal;
			}
			#modal-panel h3 {
				font-family: 'Goudy Bookletter 1911', serif;
				margin: 10px 0 5px 10px;
				padding: 0;
				font-weight: normal;
			}
			#modal-panel p {
				font-family: 'Goudy Bookletter 1911', serif;
				margin: 10px;
				text-align: justify;
			}
			#modal-panel img.cover {
				width:80px;
				height:auto;
				float:left;
				margin: 4px 8px 0 0;
			}
			#modal-panel input {
				border: 1px solid #666;
				width: 400px;
				font-family: sans-serif;
				font-size: 0.8em;
				margin: 0 0 0 10px;
				padding:3px;
				box-sizing: border-box;
				-moz-box-sizing: border-box;
				-webkit-box-sizing: border-box;
			}
			#modal-panel textarea {
				resize:none;
				overflow: hidden;
				border: 1px solid #666;
				width: 400px;
				height: 53px;
				font-family: sans-serif;
				font-size: 0.8em;
				margin: 0 0 0 10px;
				padding:3px;
				box-sizing: border-box;
				-moz-box-sizing: border-box;
				-webkit-box-sizing: border-box;
			}

			#modal {
				display:none;
			}
			.show-modal #modal {
				display:block;
			}
			/* the book, not actually a book but made to appear like one (like the act of biography) */

			/* single page mode */
			.single-page-mode #poems #previous-page,
			.single-page-mode #poems #next-page {
				display:none;
			}
			.single-page-mode #poems .pages {
				display:none;
			}
			.single-page-mode #poems .page {
				top:0px;
				right:332px;
      -webkit-transition: top 0.5s ease;
         -moz-transition: top 0.5s ease;
           -o-transition: top 0.5s ease;
              transition: top 0.5s ease;
              transform: none;
			}
			.single-page-mode #poems .page.turned {
				-webkit-transform: none; /* add specific */
				-moz-transform: none; /* add specific */
				-o-transform: none; /* add specific */
				transform: none; /* add specific */
			}
			.single-page-mode #poems .page .verso-poem {
				-webkit-transform: none; /* add specific */
				-moz-transform: none; /* add specific */
				-o-transform: none; /* add specific */
				transform: none; /* add specific */
			}
			.single-page-mode #poems .page.following {
				top: 753px;
			}
			.single-page-mode #poems .page.preceding {
				top: -753px;
			}
			.single-page-mode #poems .page.offscreen.following {
				top: 1506px;
			}
			.single-page-mode #poems .page.offscreen.preceding {
				top: -1506px;
			}
			.single-page-mode.reading #poems .page {
      -webkit-transition: top 1s linear;
         -moz-transition: top 1s linear;
           -o-transition: top 1s linear;
              transition: top 1s linear;
			}
			.reading #poems .page {
      -webkit-transition: -webkit-transform 4s linear;
         -moz-transition: -moz-transform 4s linear;
           -o-transition: -o-transform 4s linear;
              transition: transform 4s linear;
			}

			@media screen and (max-width: 420px) {

				#modal-panel {
					position:absolute; 
					z-index: 100;

					width:100%;
					height:270px;
					box-sizing: border-box;
					-moz-box-sizing: border-box;
					-webkit-box-sizing: border-box;
				}
				#modal-panel input, #modal-panel textarea {
					width:95%;
					box-sizing: border-box;
					-moz-box-sizing: border-box;
					-webkit-box-sizing: border-box;					
				}
			}

			/* preloader */
			body:after {
				display:none;
				content: 	url("./images/cover.png") 
							url("./images/up-arrow.svg")
							url("./images/close.svg")
							url("./images/samson.jpg")
							url("./images/erectingshop.png");
			}
		</style>
	</head>
	<body>
		<header><h1 id="title">The Durham Poems</h1></header>
		<div id="poems">
			<a id="previous-page"></a>
			<a id="next-page"></a>
		</div>
		<div id="controls-tab"><button type="button" id="controls-switch"><img alt="Hide controls" title="Hide controls" src="./images/down-arrow.svg" /></button></div>
		<menu>
			<li><button type="button" id="about"><abbr title="About">i</abbr></button></li>
			<li><button type="button" id="play-pause"><img alt="Play" title="Play" src="./images/play.svg" /></button></li>
			<li><button type="button" id="share"><img alt="Share" title="Share" src="./images/share.svg" /></button></li>
			<li><button type="button" id="single-page"><img alt="Single page" title="Show single page view" src="./images/single-page.svg" /></button></li>
			<li><button type="button" id="double-page"><img alt="Double page" title="Show double page view" src="./images/double-page.svg" /></button></li>
			<li><button type="button" id="fullscreen"><img id="fullscreen-icon" alt="Fullscreen" title="Go fullscreen" src="./images/fullscreen.svg" /></button></li>
			<li><button type="button" id="previous-control"><img alt="Previous page" title="Previous page" src="./images/previous-arrow.svg" /></button></li>
			<li><button type="button" id="next-control"><img alt="Next page" title="Next page" src="./images/next-arrow.svg" /></button></li>
		</menu>
		<script type="text/javascript">
		"use strict";
		
		function ChapbookPrinter(chapbook, publisher, city, country, acknowledgements, sources) {
			//keep publishing city contained within the chapbook printer
			this.chapbook = chapbook;
			this.acknowledgements = acknowledgements;
			this.sources = sources;
			this.publisher = publisher;
			this.city = city; 
			this.country = country; 
			this.year = new Date().getUTCFullYear(); //change to current year


			this.currentPageSpread = 0;
			this.modeDoublePage = true;
			this.inTransition = false;

			this.removePage = "#page-1";
			this.turningPage = "#page-2";

			this.pageSettings = [
				{
					"side" : "recto",
					"header" : { "x" : 60, "y" : 40, "edge" : "start"},
					"footer" : { "x" : 360, "y" : 460, "edge" : "end"},
					"width" : 400,
					"height" : 500,
					"edge" : "end"
				},
				{
					"side" : "verso",
					"header" : { "x" : 40, "y" : 40, "edge" : "start"},
					"footer" : { "x" : 40, "y" : 460, "edge" : "start"},
					"width" : 400,
					"height" : 500,
					"edge" : "start"
				}
			];
			this.startingPage = 3;

			//initialise printing?
		}

		ChapbookPrinter.prototype.determinePublishingCity = function(geoposition) {
			var geocoder = new google.maps.Geocoder();
			var latlng = new google.maps.LatLng(geoposition.coords.latitude, geoposition.coords.longitude);
			var _this = this;
			var _city = this.city;
			var _country = this.country;
			geocoder.geocode({'latLng': latlng}, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
					if (results[0]) {
						var cityFound = false;
						for (var i=0;i<results[0].address_components.length;i++) {
							if ((results[0].address_components[i].types[0]=="locality") && !cityFound ) {
								_city = results[0].address_components[i].long_name;
								cityFound = true;
							} else if ((results[0].address_components[i].types[0]=="administrative_area_level_2") && !cityFound ){
								_city = results[0].address_components[i].long_name;
								cityFound = true;
							}
							if (results[0].address_components[i].types[0]=="country") {
								_country = results[0].address_components[i].long_name;
							}
						}
						if (!cityFound) {
							//reset
							_city = _this.city;
							_country = _this.country;
						}
					} 
				} 
				_this.city = _city;
				_this.country = _country;
			});
		}

		ChapbookPrinter.prototype.updatePublishingCity = function() { //update publishing city
			if (navigator.geolocation) {
				var _this = this;
				navigator.geolocation.getCurrentPosition(function(geoposition) { 
					_this.determinePublishingCity(geoposition); 
				});
			} 
		}
		ChapbookPrinter.prototype.resetInTransition = function() {
			if (this.inTransition) {
				// destroy previous page
				d3.select(this.removePage).remove();
				d3.select(this.turningPage).classed("turning", false); 
				this.inTransition = false;
			}
		}
		ChapbookPrinter.prototype.nextPage = function() {
			//increment the page spread and render
			if (!this.inTransition) {
				if (this.modeDoublePage) {
					this.currentPageSpread += 1;
					if (this.currentPageSpread > (Math.floor(this.chapbook.poems.length/2) + 5)) {
						this.currentPageSpread = 0;
					}

					var removePageNum = this.currentPageSpread > 0 ? this.currentPageSpread : Math.floor(this.chapbook.poems.length/2) + 6;
					var turnPageNum = this.currentPageSpread + 1;
					var addPageNum = (this.currentPageSpread < (Math.floor(this.chapbook.poems.length/2) + 5)) ? this.currentPageSpread + 2 : 1;

					var firstPage = (this.currentPageSpread*2) - 6;

					var afterPoems = Math.floor(this.chapbook.poems.length/2) + 4;

					this.removePage = "#page-" + removePageNum;
					this.turningPage = "#page-" + turnPageNum;
					this.addPage("page-" + addPageNum);

					d3.select("#page-" + turnPageNum).classed("turned", true).classed("turning", true);

					switch (true) {
						case this.currentPageSpread == 0:
							this.printPreTitlePage("#page-2");
							this.printImagePage("#page-2");
							break;
						case this.currentPageSpread == 1:
							this.printTitlePage("#page-3");
							this.tabulaRasa("#page-3", 1);
							this.printImprintPage("#page-3");
							break;
						case this.currentPageSpread == 2:
							this.printContentsPage("#page-4");
							this.tabulaRasa("#page-4", 1);
							this.printQuotePage("#page-4");
							break;
						case this.currentPageSpread == 3:
							this.printPoemPage("#page-5", 0);
							break;
						case this.currentPageSpread == afterPoems:
							this.tabulaRasa("#page-" + turnPageNum, 1);
							this.printImagePage("#page-" + turnPageNum, postImageSrc);
							if (this.acknowledgements) {
								this.printAcknowledgementsPage("#page-" + addPageNum);
							}
							break;
						case this.currentPageSpread == afterPoems + 1:
							//add blank to last page and to page 1
							this.tabulaRasa("#page-" + turnPageNum, 1);
							this.tabulaRasa("#page-" + addPageNum, 0);
							break;
						default:
							this.printPoemPage("#page-" + addPageNum, firstPage);
							this.printPoemPage("#page-" + turnPageNum, firstPage - 1);
							break;
					}
				} else {
					var removePageNum = this.currentPageSpread + 1;
					this.currentPageSpread += 1;
					this.currentPageSpread = (this.currentPageSpread > this.chapbook.poems.length + 10) ? 0 : this.currentPageSpread;
					//remove page number (current page)
					var newPageID = this.currentPageSpread + 1;
					var afterPoems = this.chapbook.poems.length + 6;

					var precedingPageID = (this.currentPageSpread < 2) ? afterPoems + (4 + this.currentPageSpread): this.currentPageSpread - 1;
					var followingPageID = (this.currentPageSpread + 1) > afterPoems + 4 ? 1 : newPageID + 1;

					this.addSinglePage("page-" + followingPageID, !(this.currentPageSpread % 2), false); //add a page ahead
					this.removePage = "#page-" + precedingPageID; //actually remove the current previous page

					var pageShift = d3.select("#page-" + followingPageID);
					pageShift.classed("offscreen", true).classed("following", true);
					//kick the tyres and force a recalc
					//https://timtaubert.de/blog/2012/09/css-transitions-for-dynamically-created-dom-elements/
					window.getComputedStyle(document.getElementById("poems")).height;
					//window.setTimeout(function(){
					pageShift.classed("offscreen", false);
					d3.select("#page-" + precedingPageID).classed("offscreen", true);
					//}, 0); //not reliable
					d3.select("#page-" + removePageNum).classed("preceding", true);
					d3.select("#page-" + newPageID).classed("following", false);

					switch (true) {
						case this.currentPageSpread == 0: // pre title page
							this.printPreTitlePage("#page-1");//right
							break;
						case this.currentPageSpread == 1: // image
							this.printImagePage("#page-2");
							break;
						case this.currentPageSpread == 2: // title page
							this.printTitlePage("#page-3");
							break;
						case this.currentPageSpread == 3: // imprint
							this.tabulaRasa("#page-4", 1);
							this.printImprintPage("#page-4");
							break;
						case this.currentPageSpread == 4:
							this.printContentsPage("#page-5"); //right
							break;
						case this.currentPageSpread == 5:
							this.tabulaRasa("#page-6", 1);
							this.printQuotePage("#page-6");
							break;
						default:
							this.printPoemPage("#page-" + newPageID, this.currentPageSpread-6);
							break;
						case this.currentPageSpread == afterPoems:
							this.tabulaRasa("#page-" + newPageID, 0); //move function into page draw
							this.printImagePage("#page-" + newPageID, postImageSrc);
							break;
						case this.currentPageSpread == afterPoems + 1:
							this.tabulaRasa("#page-" + newPageID, 1);
							if (this.acknowledgements) {
								this.printAcknowledgementsPage("#page-" + newPageID);
							}
							break;
						case this.currentPageSpread == afterPoems + 2:
							this.tabulaRasa("#page-" + newPageID, 0);
							break;
						case this.currentPageSpread == afterPoems + 3:
							this.tabulaRasa("#page-" + newPageID, 1);
							break;
						case this.currentPageSpread == afterPoems + 4:
							this.tabulaRasa("#page-" + newPageID, 0);
							break;
					}
				}
				//set transition state commenced
				this.inTransition = true;
			}
		}

		ChapbookPrinter.prototype.previousPage = function() {
			if (!this.inTransition) {
				if (this.modeDoublePage) {
					this.currentPageSpread -= 1;
					if (this.currentPageSpread < 0) {
						this.currentPageSpread = Math.floor(this.chapbook.poems.length/2) + 5;
					}
					
					var afterPoems = Math.floor(this.chapbook.poems.length/2) + 4; //calculate and keep in object

					var addPageNum = this.currentPageSpread + 1;
					var unturnPageNum = this.currentPageSpread < afterPoems + 1 ? this.currentPageSpread + 2 : (this.currentPageSpread-afterPoems);
					var removePageNum = this.currentPageSpread < afterPoems ? this.currentPageSpread + 3 : (this.currentPageSpread-afterPoems) + 1;
					
					var firstPage = (this.currentPageSpread*2) - 6;

					this.removePage = "#page-" + removePageNum;
					this.turningPage = "#page-" + unturnPageNum;

					this.addPage("page-" + addPageNum, true, "#page-" + unturnPageNum);
					this.unturnPage("#page-" + unturnPageNum);

					switch (true) {
						case this.currentPageSpread == 0:
						//unturn last page
							this.tabulaRasa("#page-1", 0);
							this.tabulaRasa("#page-1", 1);
							break;
						case this.currentPageSpread == 1:
							this.printPreTitlePage("#page-2");
							this.printImagePage("#page-2");
							break;
						case this.currentPageSpread == 2:
							this.printTitlePage("#page-3");
							this.tabulaRasa("#page-3", 1);
							this.printImprintPage("#page-3");
							break;
						case this.currentPageSpread == 3:
							this.printContentsPage("#page-4");
							this.tabulaRasa("#page-4", 1);
							this.printQuotePage("#page-4");
							this.printPoemPage("#page-5", 0);
							break;
						case this.currentPageSpread == afterPoems:
							this.tabulaRasa("#page-" + addPageNum, 1);
							this.printImagePage("#page-" + addPageNum, postImageSrc);
							if (this.acknowledgements) {
								this.printAcknowledgementsPage("#page-" + unturnPageNum);
							}
							break;
						case this.currentPageSpread == afterPoems + 1:
							this.tabulaRasa("#page-" + addPageNum, 1);
							this.tabulaRasa("#page-" + unturnPageNum, 0);
							break;
						default:
							this.printPoemPage("#page-" + addPageNum, firstPage - 1);
							this.printPoemPage("#page-" + unturnPageNum, firstPage);
							break;
					}
				} else {
					var removePageNum = this.currentPageSpread + 1;
					this.currentPageSpread -= 1;
					this.currentPageSpread = (this.currentPageSpread < 0) ? this.chapbook.poems.length + 10 : this.currentPageSpread;
					//remove page number (current page)
					var newPageID = this.currentPageSpread + 1;
					var afterPoems = this.chapbook.poems.length + 6;

					var precedingPageID = (this.currentPageSpread < 1) ? afterPoems + 5: this.currentPageSpread;
					var followingPageID = (this.currentPageSpread + 2) > afterPoems + 4 ? 2 + (this.currentPageSpread - (this.chapbook.poems.length + 10)) : newPageID + 2;

					this.addSinglePage("page-" + precedingPageID, !(this.currentPageSpread % 2), false); //add a page ahead
					this.removePage = "#page-" + followingPageID; //actually remove the current following page
					
					var pageShift = d3.select("#page-" + precedingPageID);
					pageShift.classed("offscreen", true).classed("preceding", true);
					window.getComputedStyle(document.getElementById("poems")).height;
					pageShift.classed("offscreen", false);
					
					d3.select("#page-" + followingPageID).classed("offscreen", true);

					d3.select("#page-" + removePageNum).classed("following", true);
					d3.select("#page-" + newPageID).classed("preceding", false);
					console.log("current page spread: " + this.currentPageSpread);

					switch (true) {
						case this.currentPageSpread == 0: // pre title page
							this.printPreTitlePage("#page-1");//right
							break;
						case this.currentPageSpread == 1: // image
							this.printImagePage("#page-2");
							break;
						case this.currentPageSpread == 2: // title page
							this.printTitlePage("#page-3");
							break;
						case this.currentPageSpread == 3: // imprint
							this.tabulaRasa("#page-4", 1);
							this.printImprintPage("#page-4");
							break;
						case this.currentPageSpread == 4:
							this.printContentsPage("#page-5"); //right
							break;
						case this.currentPageSpread == 5:
							this.tabulaRasa("#page-6", 1);
							this.printQuotePage("#page-6");
							break;
						default:
							console.log("adding poem:" + (this.currentPageSpread - 6));
							this.printPoemPage("#page-" + newPageID, this.currentPageSpread-6);
							break;
						case this.currentPageSpread == afterPoems:
							this.tabulaRasa("#page-" + newPageID, 0); //move function into page draw
							this.printImagePage("#page-" + newPageID, postImageSrc);
							break;
						case this.currentPageSpread == afterPoems + 1:
							this.tabulaRasa("#page-" + newPageID, 1);
							if (this.acknowledgements) {
								this.printAcknowledgementsPage("#page-" + newPageID);
							}
							break;
						case this.currentPageSpread == afterPoems + 2:
							this.tabulaRasa("#page-" + newPageID, 0);
							break;
						case this.currentPageSpread == afterPoems + 3:
							this.tabulaRasa("#page-" + newPageID, 1);
							break;
						case this.currentPageSpread == afterPoems + 4:
							this.tabulaRasa("#page-" + newPageID, 0);
							break;
					}
				}
				this.inTransition = true;
			}
		}
		ChapbookPrinter.prototype.addPage = function(pageID, turned, before) {
			var _this = this;
			var insertLocation = before ? before : "#next-page";
			var pageAdded = d3.select("#poems").insert("div", insertLocation).attr("id", pageID).attr("class", "page").classed("turned", turned).on("transitionend", function() { _this.resetInTransition() }); //fix this
			pageAdded.append("div").attr("class", "recto-poem").append("div").attr("class","recto pages");
			pageAdded.append("div").attr("class", "verso-poem").append("div").attr("class","verso pages");

		}

		ChapbookPrinter.prototype.addSinglePage = function(pageID, isVerso, hasClass) {
			//append to #poems
			var _this = this;
			var pageAdded = d3.select("#poems").insert("div").attr("id", pageID).attr("class", "page").on("transitionend", function() { _this.resetInTransition() }); //fix this
			var pageClass = isVerso ? "verso-poem" : "recto-poem";
			pageAdded.append("div").attr("class", pageClass);
		}

		ChapbookPrinter.prototype.unturnPage = function(pageID) {
			d3.select(pageID).classed("turned", false).classed("turning", true);
		}


		//update to make reading mode a toggle
		// move to reader
		//split function so interface altering elements are moved to reader and page altering elements are kept in printer
		ChapbookPrinter.prototype.singlePageMode = function() {
			if (this.modeDoublePage && !this.inTransition){
				this.modeDoublePage = false;
				d3.select("#single-page").attr("disabled", "disabled");
				d3.select("#double-page").attr("disabled", null);
				console.log("current page spread: " + this.currentPageSpread);
				d3.select("body").classed("single-page-mode", true);
				//remove pages this.currentPageSpread +1 and this.currentPageSpread +2
				var versoPage = this.currentPageSpread + 1;
				var rectoPage = (this.currentPageSpread < (Math.floor(this.chapbook.poems.length/2) + 5)) ? this.currentPageSpread + 2 : 1;
				var afterPoems = this.chapbook.poems.length + 6; //add this to printer properties? make it a calculation function
				//remove pages
				d3.select("#page-" + versoPage).remove();
				d3.select("#page-" + rectoPage).remove();
				d3.select("#previous-page").remove();
				d3.select("#next-page").remove();
				//convert page format *2 (even recto, odd verso)
				this.currentPageSpread = this.currentPageSpread*2;
				//add page
				var currentPageID = this.currentPageSpread + 1;

				this.addSinglePage("page-" + currentPageID, this.currentPageSpread % 2, true); //add current page
				//add preceding page
				var precedingPageID = (this.currentPageSpread == 0) ? afterPoems + 5: this.currentPageSpread;
				var followingPageID = (this.currentPageSpread + 1) > afterPoems + 4 ? 1 : currentPageID + 1;

				this.addSinglePage("page-" + precedingPageID, true, true); //add current page
				this.addSinglePage("page-" + followingPageID, true, true); //add current page

				d3.select("#page-" + precedingPageID).classed("preceding", true);
				d3.select("#page-" + followingPageID).classed("following", true);

				switch (true) {
					case this.currentPageSpread == 0: // pre title page
						this.printPreTitlePage("#page-1");//right
						break;
					case this.currentPageSpread == 1: // image
						this.printImagePage("#page-2");
						break;
					case this.currentPageSpread == 2: // title page
						this.printTitlePage("#page-3");
						break;
					case this.currentPageSpread == 3: // imprint
						this.tabulaRasa("#page-4", 1);
						this.printImprintPage("#page-4");
						break;
					case this.currentPageSpread == 4:
						this.printContentsPage("#page-5"); //right
						break;
					case this.currentPageSpread == 5:
						this.tabulaRasa("#page-6", 1);
						this.printQuotePage("#page-6");
						break;
					default:
						this.printPoemPage("#page-" + currentPageID, this.currentPageSpread-6);
						break;
					case this.currentPageSpread == afterPoems:
						this.tabulaRasa("#page-" + currentPageID, 0); //move function into page draw
						this.printImagePage("#page-" + currentPageID, postImageSrc);
						break;
					case this.currentPageSpread == afterPoems + 1:
						this.tabulaRasa("#page-" + currentPageID, 1);
						if (this.acknowledgements) {
							this.printAcknowledgementsPage("#page-" + currentPageID);
						}
						break;
					case this.currentPageSpread == afterPoems + 2:
						this.tabulaRasa("#page-" + currentPageID, 0);
						break;
					case this.currentPageSpread == afterPoems + 3:
						this.tabulaRasa("#page-" + currentPageID, 1);
						break;
					case this.currentPageSpread == afterPoems + 4:
						this.tabulaRasa("#page-" + currentPageID, 0);
						break;
				}
				//updateWindow(); //move to reader
			}
		}
		// move to reader
		ChapbookPrinter.prototype.doublePageMode = function() {
			console.log("current page spread: " + this.currentPageSpread);
			if (!this.modeDoublePage && !this.inTransition) {
				var _this = this;
				d3.select("#double-page").attr("disabled", "disabled");
				d3.select("#single-page").attr("disabled", null);
				this.modeDoublePage = true;
				d3.select("body").classed("single-page-mode", false);
				//next and previous
				d3.select("#poems").insert("a").attr("id", "next-page").on("click", 
					function() { _this.nextPage(); }
				);
				d3.select("#poems").insert("a").attr("id", "previous-page").on("click", 
					function() { _this.previousPage(); }
				);

				//remove the three pages

				var currentPageID = this.currentPageSpread + 1;
				var afterPoems = this.chapbook.poems.length + 6;

				d3.select("#page-" + currentPageID).remove(); //add current page
				//add preceding page
				var precedingPageID = (this.currentPageSpread == 0) ? afterPoems + 5: this.currentPageSpread;
				var followingPageID = (this.currentPageSpread + 1) > afterPoems + 4 ? 1 : currentPageID + 1;
				console.log("preceding page: " + precedingPageID);
				console.log("following page: " + followingPageID);
				console.log("current page spread: " + this.currentPageSpread);

				d3.select("#page-" + precedingPageID).remove();
				d3.select("#page-" + followingPageID).remove();

				this.currentPageSpread = Math.ceil(this.currentPageSpread/2);
				console.log("current page spread: " + this.currentPageSpread);
				
				if (this.currentPageSpread > (Math.floor(this.chapbook.poems.length/2) + 5)) {
							this.currentPageSpread = 0;
						}

				var firstPageNum = this.currentPageSpread + 1;
				var secondPageNum = (this.currentPageSpread < (Math.floor(this.chapbook.poems.length/2) + 5)) ? this.currentPageSpread + 2 : 1;
				var firstPage = (this.currentPageSpread*2) - 6;

				afterPoems = Math.floor(this.chapbook.poems.length/2) + 4;

				this.addPage("page-" + firstPageNum, true);
				this.addPage("page-" + secondPageNum);

				//convert this.currentPageSpread
				switch (true) {
					case this.currentPageSpread == 0:
						this.tabulaRasa("#page-1", 1);
						this.tabulaRasa("#page-1", 0);				
						this.printPreTitlePage("#page-2");
						this.printImagePage("#page-2");
						break;
					case this.currentPageSpread == 1:
						this.printPreTitlePage("#page-2");
						this.printImagePage("#page-2");				
						this.printTitlePage("#page-3");
						this.tabulaRasa("#page-3", 1);
						this.printImprintPage("#page-3");
						break;
					case this.currentPageSpread == 2:
						this.printTitlePage("#page-3");
						this.tabulaRasa("#page-3", 1);
						this.printImprintPage("#page-3");				
						this.printContentsPage("#page-4");
						this.tabulaRasa("#page-4", 1);
						this.printQuotePage("#page-4");
						break;
					case this.currentPageSpread == 3:
						this.printContentsPage("#page-4");
						this.tabulaRasa("#page-4", 1);
						this.printQuotePage("#page-4");
						this.printPoemPage("#page-5", 0);
						break;
					case this.currentPageSpread == afterPoems:
						this.tabulaRasa("#page-" + firstPageNum, 1);
						this.printImagePage("#page-" + firstPageNum, postImageSrc);
						if (this.acknowledgements) {
							this.tabulaRasa("#page-" + secondPageNum, 0);
							this.printAcknowledgementsPage("#page-" + secondPageNum);
						}
						break;
					case this.currentPageSpread == afterPoems + 1:
						//add blank to last page and to page 1
						this.tabulaRasa("#page-" + firstPageNum, 1);
						this.tabulaRasa("#page-" + secondPageNum, 0);
						this.tabulaRasa("#page-" + secondPageNum, 1);
						break;
					default:
						this.printPoemPage("#page-" + firstPageNum, firstPage - 1);
						this.printPoemPage("#page-" + secondPageNum, firstPage);
						break;
				}
				//updateWindow(); //move to controller
			}
		}
		ChapbookPrinter.prototype.printImprintPage = function(pageID) {
			var page = this.pageSettings[1];
			var svgRoot = d3.select(pageID).select("." + page.side + "-poem");
			//remove current poem if it exists
			svgRoot.select("." + page.side + "-page-svg").remove();
			var svg = svgRoot.append("svg").attr("class", page.side + "-page-svg").attr("viewBox", "0 0 400 500");
			
			var yLayoutPosition = 40,
				yIncrement = 15;

			var initY = 40,
				incrementY = 15;

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition)
				.attr("text-anchor", "start")
				.text("First Published " + this.year); //or fix the date ...

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("By " + this.publisher.name);

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text(this.publisher.url);

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=(2*yIncrement))
				.attr("text-anchor", "start")
				.text("© " + this.chapbook.author.join(" ") + " " + this.year);

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=(2*yIncrement))
				.attr("text-anchor", "start")
				.text("Designed by Benjamin Laird");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("Typeset with D3");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("In Goudy Bookletter 1911");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=(2*yIncrement))
				.attr("text-anchor", "start")
				.text("Printed and bound in HTML, SVG, CSS and JavaScript");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("Distributed by the Internet");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=(2*yIncrement))
				.attr("text-anchor", "start")
				.text(this.chapbook.author.reverse().join(", "));

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text(this.chapbook.title + " / " + this.chapbook.author.reverse().join(" "));
			
			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("URI " + window.location.origin + window.location.pathname);

			/* the following copyright statement is satirical and not to be taken literally */
			
			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=(2*yIncrement))
				.attr("text-anchor", "start")
				.text("All rights reserved.");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("No part of this publication may be");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("reproduced, stored in a retrieval system or");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("transmitted in any form or by any means");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("electronic, mechanical, photocopying or");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("otherwise without the prior permission of");

			svg.append("text")
				.attr("class", "imprint")
				.attr("dx", 40)
				.attr("dy", yLayoutPosition+=yIncrement)
				.attr("text-anchor", "start")
				.text("the publisher.");

		}
		ChapbookPrinter.prototype.printTitlePage = function(pageID) {
			var page = this.pageSettings[0];
			var svgRoot = d3.select(pageID).select("." + page.side + "-poem");
			//remove current poem if it exists
			svgRoot.select("." + page.side + "-page-svg").remove();
			var svg = svgRoot.append("svg").attr("class", page.side + "-page-svg").attr("viewBox", "0 0 400 500");
			svg.append("text")
				.attr("class", "inter-title")
				.attr("dx", 200)
				.attr("dy", 40)
				.attr("text-anchor", "middle")
				.text("THE"); //split out the first word? //title article (if title article insert here otherwise ignore and use title article to create a full title property)

			svg.append("text")
				.attr("id", "main-title")
				.attr("dx", 200)
				.attr("dy", 90)
				.attr("text-anchor", "middle")
				.text(this.chapbook.title.toUpperCase() + ";");
			
			svg.append("text")
				.attr("class", "inter-title")
				.attr("dx", 200)
				.attr("dy", 130)
				.attr("text-anchor", "middle")
				.text("OR,");

			svg.append("text")
				.attr("id", "main-alternate-title")
				.attr("dx", 200)
				.attr("dy", 170)
				.attr("text-anchor", "middle")
				.text(this.chapbook.alternateTitle.split(" ")[0].toUpperCase());

			svg.append("text")
				.attr("id", "sub-alternate-title")
				.attr("dx", 200)
				.attr("dy", 210)
				.attr("text-anchor", "middle")
				.text(this.chapbook.alternateTitle.split(" ").slice(1).join(" ").toUpperCase() + '.');

			svg.append("text")
				.attr("class", "inter-title")
				.attr("dx", 200)
				.attr("dy", 280)
				.attr("text-anchor", "middle")
				.text("BY");

			svg.append("text")
				.attr("id", "author")
				.attr("dx", 200)
				.attr("dy", 300)
				.attr("text-anchor", "middle")
				.text(this.chapbook.author.join(" ").toUpperCase());

			svg.append("text")
				.attr("class", "quote")
				.attr("dx", 200)
				.attr("dy", 360)
				.attr("text-anchor", "middle")
				.text("“" + this.chapbook.quote.quote + "”");

			svg.append("text")
				.attr("class", "quote-author")
				.attr("dx", 310)
				.attr("dy", 375)
				.attr("text-anchor", "end")
				.text(this.chapbook.quote.author + ".");

			svg.append("text")
				.attr("id", "place")
				.attr("dx", 200)
				.attr("dy", 420)
				.attr("text-anchor", "middle")
				.text(this.city.toUpperCase() + ", " + this.country.toUpperCase() + ":");

			svg.append("text")
				.attr("id", "publisher")
				.attr("dx", 200)
				.attr("dy", 440)
				.attr("text-anchor", "middle")
				.text(this.publisher.name.toUpperCase() + ",");

			svg.append("text")
				.attr("id", "year")
				.attr("dx", 200)
				.attr("dy", 455)
				.attr("text-anchor", "middle")
				.text(this.year + ".");
		}
		ChapbookPrinter.prototype.printPreTitlePage = function(pageID) {
			var page = this.pageSettings[0];
			var svgRoot = d3.select(pageID).select("." + page.side + "-poem");
			//remove current poem if it exists
			svgRoot.select("." + page.side + "-page-svg").remove();
			var svg = svgRoot.append("svg").attr("class", page.side + "-page-svg").attr("viewBox", "0 0 400 500");

			svg.append("text")
				.attr("id", "main-pre-title")
				.attr("dx", 200)
				.attr("dy", 180)
				.attr("text-anchor", "middle")
				.text(("The " + this.chapbook.title).toUpperCase());
			
		}
		ChapbookPrinter.prototype.printQuotePage = function(pageID) {
			var page = this.pageSettings[1];
			var svgRoot = d3.select(pageID).select("." + page.side + "-poem");
			//remove current poem if it exists
			svgRoot.select("." + page.side + "-page-svg").remove();
			var svg = svgRoot.append("svg").attr("class", page.side + "-page-svg").attr("viewBox", "0 0 400 500");

			//add loop in for length of lines

			svg.append("text")
				.attr("class", "quote")
				.attr("dx", 50)
				.attr("dy", 200)
				.attr("text-anchor", "start")
				.text("“The town I once knew has departed and a new town with the old");

			svg.append("text")
				.attr("class", "quote")
				.attr("dx", 60)
				.attr("dy", 215)
				.attr("text-anchor", "start")
				.text("name is here.”");

			var quoteLine = svg.append("text")
				.attr("class", "quote")
				.attr("dx", 110)
				.attr("dy", 230)
				.attr("text-anchor", "start");

			quoteLine.append("tspan")
				.attr("class", "quote-author")
				.text("William Denton");

			quoteLine.append("tspan")
				.text(", Darlington, 25 December 1876");
			
		}
		ChapbookPrinter.prototype.printImagePage = function(pageID, specificImage, pageOrientation) {
			var page = this.pageSettings[1];
			var primary = d3.select(pageID).select("." + page.side + "-poem");
			//remove current poem if it exists
			primary.select("." + page.side + "-page-svg").remove();
			console.log(specificImage);
			primary.select("img").remove() //replace once clear function works correctly

			if (!specificImage) {
				primary.append("img")
					.attr("src", this.chapbook.image)
					.attr("id", "featured-image");
			} else {
				primary.append("img")
					.attr("src", specificImage)
					.attr("id", "featured-image");
			}
		}
		ChapbookPrinter.prototype.printContentsPage = function(pageID) {
			var page = this.pageSettings[0];
			var svgRoot = d3.select(pageID).select("." + page.side + "-poem");
			//remove current poem if it exists
			svgRoot.select("." + page.side + "-page-svg").remove();
			var svg = svgRoot.append("svg").attr("class", page.side + "-page-svg").attr("viewBox", "0 0 400 500");
			var yLoc = 90;
			var xLocTitle = 70;
			var xLocPage = 320;
			var increment = 20;

			svg.append("text")
				.attr("id", "contents-title")
				.attr("dx", (((xLocPage-xLocTitle)/2) + xLocTitle))
				.attr("dy", 50)
				.attr("text-anchor", "middle")
				.text("CONTENTS");

			for (var i=0;i<this.chapbook.poems.length;i++) {
				svg.append("text")
					.attr("class", "contents-poem-title")
					.attr("dx", xLocTitle)
					.attr("dy", yLoc+(increment*i))
					.attr("text-anchor", "start")
					.text(this.chapbook.poems[i].title);

				svg.append("text")
					.attr("class", "contents-poem-page-number")
					.attr("dx", xLocPage)
					.attr("dy", yLoc+(increment*i))
					.attr("text-anchor", "end")
					.text(i+this.startingPage);
			}
		}
		ChapbookPrinter.prototype.printAcknowledgementsPage = function(pageID) {
			var page = this.pageSettings[0];
			var svgRoot = d3.select(pageID).select("." + page.side + "-poem");
			//remove current poem if it exists
			svgRoot.select("." + page.side + "-page-svg").remove();
			var svg = svgRoot.append("svg").attr("class", page.side + "-page-svg").attr("viewBox", "0 0 400 500");
			var yLoc = 70;
			var xLocTitle = 70;
			var xLocText = 50;
			var xLocPage = 320;
			var increment = 20;

			svg.append("text")
				.attr("class", "acknowledments-title")
				.attr("dx", (((xLocPage-xLocTitle)/2) + xLocTitle))
				.attr("dy", 50)
				.attr("text-anchor", "middle")
				.text("Acknowledgements".toUpperCase());

			var text = svg.append("text")
				.attr("class", "acknowledgements")
				.attr("dx", 0)
				.attr("dy", yLoc)
				.attr("text-anchor", "start");
			
			var words = this.acknowledgements.text.split(/\s+/).reverse();
			var word;
			var width = 280;
			var line = [];
			var lineNumber = 0;
			var lineHeight = 14; // pixels
			var y = 12;
			var dy = parseFloat(text.attr("dy"));
			var tspan = text.text(null).append("tspan").attr("x", (((xLocPage-xLocTitle)/2) + xLocTitle)-140).attr("y", y).attr("dy", dy);
			while (word = words.pop()) {
				line.push(word);
				tspan.text(line.join(" ")); //last line when we've run out of words which is not justified
				if (tspan.node().getComputedTextLength() > width) {
					line.pop();
					tspan.text(line.join(" "));
					var wordSpacing = (width - tspan.node().getComputedTextLength()) / (line.length-1);
					//apply wordspacing recalculate and reapply for a Chrome bug ...
					tspan.attr("word-spacing", wordSpacing);
					wordSpacing = (width - tspan.node().getComputedTextLength()) / (line.length-1);
					tspan.attr("word-spacing", wordSpacing);
					wordSpacing = (width - tspan.node().getComputedTextLength()) / (line.length-1);
					tspan.attr("word-spacing", wordSpacing);
					wordSpacing = (width - tspan.node().getComputedTextLength()) / (line.length-1);
					tspan.attr("word-spacing", wordSpacing);

					line = [word];
					tspan = text.append("tspan").attr("x", (((xLocPage-xLocTitle)/2) + xLocTitle)-140).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy).text(word);
				}
			}
			if (this.sources) {
				var startLineNum = lineNumber * lineHeight + dy + 60;
				svg.append("text")
					.attr("class", "acknowledments-title")
					.attr("dx", (((xLocPage-xLocTitle)/2) + xLocTitle))
					.attr("dy", startLineNum)
					.attr("text-anchor", "middle")
					.text("Sources".toUpperCase());
				for (var i=0; i<sources.length; i++) {
					//print a source
					//add title and then start adding and computing words? title wrapping?
				}
			}



		}
		ChapbookPrinter.prototype.printPoemPage = function(pageID, poemIndex) {
			//index determines page number and whether recto or verso
			
			var pageNumber = poemIndex + this.startingPage;
			var page = this.pageSettings[(poemIndex % 2)];
			var poem = this.chapbook.poems[poemIndex];

			//d3.select("#featured-image").remove();

			var svgRoot = d3.select(pageID).select("." + page.side + "-poem");
			//remove current poem if it exists
			console.log(pageID);
			svgRoot.select("." + page.side + "-page-svg").remove();

			var svg = svgRoot.append("svg").attr("class", page.side + "-page-svg").attr("viewBox", "0 0 400 500");
	
			var force = d3.layout.force()
				.gravity(.05)
				.distance(100)
				.charge(-50)
				.size([page.width, page.height])
				.nodes(poem.nodes)
				.links(poem.links);

			var link = svg.selectAll(".link-" + poemIndex + "-" + page.side)
			  .data(poem.links, function(d){return d.id;});
			
			link.enter().insert("text")
				.attr("class", "text")
				.attr("text-anchor", "middle")
				.append("textPath")
				.attr("startOffset", "50%")
				.attr("xlink:href", function(d) {return "#l-" + poemIndex + "-" + page.side + "-" + d.id;})
				.text(function(d) { return d.text });

			link.enter().insert("path", ":first-child")
				.classed("link-" + page.side, true)
				.classed("link-" + poemIndex + "-" + page.side, true)
				.attr("id", function(d) {return "l-" + poemIndex + "-" + page.side + "-" +d.id;});

			link.exit().remove();

			//add nodes
			var node = svg.selectAll(".node-" + poemIndex + "-" + page.side)
			  .data(poem.nodes, function(d){return d.id;});
			
			var nodeG = node.enter().insert("g")
			  .classed("node-" + page.side, true)
			  .classed("node-" + poemIndex + "-" + page.side, true)
			  .attr("id", function(d){return "n-" + poemIndex + "-" + page.side + "-" + d.id;})
			  .call(force.drag);
			
			nodeG.append("text")
			  .attr("dx", 0)
			  .attr("dy", 0)
			  .attr("text-anchor", "middle")
			  .text(function(d) { return d.text });

			node.exit().remove();
			force.on("tick", function() {
				link.attr("d", function(d) { return "M " + d.source.x + " " + d.source.y + "L "  + d.target.x + " " + d.target.y; } );
				node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
			});
			force.start();

			svg.append("text")
				.attr("class", "folio")
				.attr("dx", page.footer.x)
				.attr("dy", page.footer.y)
				.attr("text-anchor", page.footer.edge)
				.text(pageNumber);

			svg.append("text")
				.attr("class", "header")
				.attr("dx", page.header.x)
				.attr("dy", page.header.y)
				.attr("text-anchor", page.header.edge)
				.text(poem.title);
		}
		ChapbookPrinter.prototype.tabulaRasa = function(pageID, pageIndex) {
			//clear page
			var page = this.pageSettings[(pageIndex % 2)];
			d3.select(pageID).select("." + page.side + "-poem").classed("no-page",false);
			d3.select(pageID).select("." + page.side + "-page-svg").remove();
			d3.select(pageID).select("#featured-image").remove();
		}
		ChapbookPrinter.prototype.removePage = function(pageID, pageIndex) {
			var page = this.pageSettings[(pageIndex % 2)];
			d3.select(pageID).select("." + page.side + "-poem").classed("no-page",true);
		}


		/* A collection of poems */
		function Chapbook(title, alternateTitle, author, image, quote, poemsCollected) {
			this.poems = [];
			this.title = title;
			this.alternateTitle = alternateTitle;
			this.author = author;
			this.image = image;
			this.quote = quote;
			this.poemsCollected = poemsCollected;
		}
		Chapbook.prototype.addPoem = function(poem) {
			this.poems.push(poem);
		}
		Chapbook.prototype.removePoem = function(poemIndex) {
			//this should do something
		}
		Chapbook.prototype.prepareForPublication = function() {
			var manuscript = this.poems.slice();
			var index = manuscript.length;
			var value, randomIndex;

			while(0 != index) {
				randomIndex = Math.floor(Math.random() * index);
				index -= 1;

				value = manuscript[index];
				manuscript[index] = manuscript[randomIndex];
				manuscript[randomIndex] = value;
			}

			this.poems = manuscript.slice(0,this.poemsCollected);
		}

		/* A poem */
		function Poem(title, words, lines) {
			this.title = title;
			this.words = words;
			this.lines = lines;
			this.nodes = [];
			for (var i=0; i<words.length; i++) {
				this.nodes.push({"id" : i, "text" : words[i]})
			}
			this.links = [];
			this.joins = [];
			for (var i=0; i<lines.length; i++) {
				var join = this.lineJoin();
				this.joins.push(join[0] + "," + join[1], join[1] + "," + join[0]);
				this.links.push({"id" : i, "source": join[0], "target": join[1], "text" : lines[i]});
			}
		}
		Poem.prototype.lineJoin = function() {
			var length = this.words.length;
			var source = 0;
			var target = 0;
			while ((source == target) || (this.joins.indexOf(source + "," + target) != -1)) {
				source = Math.floor(Math.random()*length);
				target = Math.floor(Math.random()*length);
			}
			return [source, target];
		}

		function ChapbookReader(chapbookPrinter) {
			this.chapbookPrinter = chapbookPrinter;
			this.isPlaying = false;
			this.pageTurnInterval = null;
			this.withControls = true;

		}
		
		ChapbookReader.prototype.updateWindow = function(){
			 var x = window.innerWidth;
			 var y = window.innerHeight;
			 var yOffset = 0;
			 var yActual = y;
			 if (this.withControls) {
			 	y-=80;
			 	yOffset = 40;
			 } else {
			 	y-=6;
			 	yOffset = 3;
			 }
			var xOffset = this.chapbookPrinter.modeDoublePage ? 0 : 3;
			if (!this.chapbookPrinter.modeDoublePage) {
				x-=6;
			}
			console.log(x);

			 var xRatio = this.chapbookPrinter.modeDoublePage ? x/1266 : x/602;
			 var yRatio = y/752;
		
			 var ratio = xRatio <= yRatio ? xRatio : yRatio;
			 
			 console.log(ratio);

			 var xLoc = ((x - (ratio*1266))/2 + xOffset).toFixed(10) + "px"; //toFixed add because of an issue with Safari and very small numbers using e notation/format			 
			 var yLoc = ((y - (ratio*752))/2 + yOffset).toFixed(10) + "px";

			 d3.select("#poems").attr("style", "transform: translate("+ xLoc +","+ yLoc +") scale("+ ratio +");transform-origin: 0 0 0;-webkit-transform: translate("+ xLoc +","+ yLoc +") scale("+ ratio +");-webkit-transform-origin: 0 0 0;");

			if (!this.inFullscreen()) {
		      	d3.select("#fullscreen-icon").attr("src", "./images/fullscreen.svg").attr("alt","Go fullscreen").attr("title", "Go fullscreen");
			 } else {
			 	
			 	d3.select("#fullscreen-icon").attr("src", "./images/exit-fullscreen.svg").attr("alt","Exit fullscreen").attr("title", "Exit fullscreen");
			 }
		}
		// http://stackoverflow.com/questions/326069/how-to-identify-if-a-webpage-is-being-loaded-inside-an-iframe-or-directly-into-t
		//chapbookreader
		ChapbookReader.prototype.inIframe = function() {
			var _inIframe;
			try {
				_inIframe = window.self !== window.top;
			} catch (error) {
				_inIframe = true;
			}
			return _inIframe;
		}
		//https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API
		ChapbookReader.prototype.inFullscreen = function() {
			return document.fullscreenElement ||    // alternative standard method
			document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
		}
		ChapbookReader.prototype.isFullscreenEnabled = function() {
			var _isFullscreenEnabled;

			if(document.fullscreenEnabled){
			   _isFullscreenEnabled = document.fullscreenEnabled;
			}
			else if(document.msFullscreenEnabled){ 
			   _isFullscreenEnabled = document.msFullscreenEnabled;
			} 
			else if (document.mozFullScreenEnabled){
			   _isFullscreenEnabled = document.mozFullScreenEnabled;
			}
			else if (document.webkitFullscreenEnabled){
			   _isFullscreenEnabled = document.webkitFullscreenEnabled;
			}
			return _isFullscreenEnabled;
		}
		ChapbookReader.prototype.toggleFullScreen = function() {
		  if (!this.inFullscreen()) {  // current working methods
		    if (document.documentElement.requestFullscreen) {
		      document.documentElement.requestFullscreen();
		    } else if (document.documentElement.msRequestFullscreen) {
		      document.documentElement.msRequestFullscreen();
		    } else if (document.documentElement.mozRequestFullScreen) {
		      document.documentElement.mozRequestFullScreen();
		    } else if (document.documentElement.webkitRequestFullscreen) {
		      document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
		    }
		  } else {
		    if (document.exitFullscreen) {
		      document.exitFullscreen();
		    } else if (document.msExitFullscreen) {
		      document.msExitFullscreen();
		    } else if (document.mozCancelFullScreen) {
		      document.mozCancelFullScreen();
		    } else if (document.webkitExitFullscreen) {
		      document.webkitExitFullscreen();
		    }
		  }
		}
		ChapbookReader.prototype.toggleControls = function() {
			if (this.withControls) {
				d3.select("body").classed("with-controls", false).classed("without-controls", true);
				this.withControls = false;
				d3.select("#controls-switch").select("img").attr("src","./images/up-arrow.svg").attr("alt", "Show controls").attr("title", "Show controls");
				this.updateWindow();
			} else {
				d3.select("body").classed("with-controls", true).classed("without-controls", false);
				this.withControls = true;
				d3.select("#controls-switch").select("img").attr("src","./images/down-arrow.svg").attr("alt", "Hide controls").attr("title", "Hide controls");
				this.updateWindow();
			}
		}
		ChapbookReader.prototype.pageScroll = function() {
			if (!this.inIframe() || this.inFullscreen()) {
				if (d3.event.deltaY > 0) {
					this.chapbookPrinter.nextPage();
				}
				else if (d3.event.deltaY < 0) {
					this.chapbookPrinter.previousPage();
				}
			}
		}
		ChapbookReader.prototype.playPauseReading = function() {
			if (!this.isPlaying) {
				this.isPlaying = true;
				d3.select("body").classed("reading", true);
				d3.select("#play-pause").select("img").attr("src","./images/pause.svg").attr("alt","Pause").attr("title","Pause");
				//start playing -- make sure the book isn't playing?
				//change play button into a pause button
				//disabled layout change modes
				d3.select("#single-page").attr("disabled", "disabled");
				d3.select("#double-page").attr("disabled", "disabled");
				this.chapbookPrinter.nextPage();
				this.pageTurnInterval = window.setInterval(
					function() { poetryChapbookPrinter.nextPage(); }
					, 5000);
			} else {
				d3.select("body").classed("reading", false);
				d3.select("#play-pause").select("img").attr("src","./images/play.svg").attr("alt","Play").attr("title","Play");
				this.isPlaying = false;
				window.clearInterval(this.pageTurnInterval);
				if (this.chapbookPrinter.modeDoublePage) {
					d3.select("#single-page").attr("disabled", null);
				} else {
					d3.select("#double-page").attr("disabled", null);
				}
			}
		}
		ChapbookReader.prototype.shareChapbook = function() {
			var sharePanel = this.addModal("Share");
			var readerURL = window.location.origin + window.location.pathname;
			sharePanel.append("h3").text("Link to this chapbook");
			sharePanel.append("input").attr("id", "chapbook-link").on("click", (function () {
   this.select(); })).attr("type","text").attr("readonly","readonly").attr("value", readerURL);

			sharePanel.append("h3").text("Embed this chapbook");
			sharePanel.append("textarea").attr("id", "chapbook-embed").on("click", (function () {
   this.select(); })).attr("readonly","readonly").attr("cols","60").attr("rows","5").html('&lt;iframe src="' + readerURL + '" style="width:100%;height:400px;" allowfullscreen="allowfullscreen"&gt;&lt;/iframe&gt;');
		}
		ChapbookReader.prototype.aboutChapbook = function() {
			var aboutPanel = this.addModal("About");
			//make h3 text dynamic
			//preload the image? what to do about the cover?
			aboutPanel.append("h3").html("About <cite>The Durham Poems</cite>");
			aboutPanel.append("p").html("<img class='cover' src='./images/cover.png' alt='' />These poems are part of a larger collection of biographical poems concerning the life of scientific lecturer, Spiritualist and radical, William Denton (1823–1883). More information about the series can be found at <a target='_top' href='https://thecodeofthings.com'><cite>The Code of Things</cite></a>.")
		}
		ChapbookReader.prototype.addModal = function(title) {
			var modal = d3.select("body").insert("div", "#poems").attr("id", "modal");
			modal.append("div").attr("id", "modal-screen");
			var modalPanel = modal.append("div").attr("id", "modal-panel");
			var modalTitle = title;
			var _this = this;
			var modalName = title.toLowerCase();
			modalPanel.append("button").attr("type", "button").attr("id","close-modal").on("click", 
					function () { _this.removeModal(); }
				).append("img").attr("src", "./images/close.svg").attr("alt", "Close " + modalName).attr("title", "Close " + modalName);
			modalPanel.append("h2").text(modalTitle);
			d3.select("body").classed("show-modal", true);

			return modalPanel;
		}

		ChapbookReader.prototype.removeModal = function() {
			d3.select("body").classed("show-modal", false); // hide modal
			d3.select("#modal").remove(); // remove modal
		}

		// image sourced from http://www.gracesguide.co.uk/File:Im1923TimHack-Erectingshop.jpg and modified and used under the terms of the GNU Free Documentation Licence, Version 1.2
		//"Poems on early William Denton"
		//"Poems covering the years 1823 to 1842"
		//"Poems on early William Denton, the years 1823 to 1842"
		//"Poems on early William Denton, the years 1823–1842"
		var poetryChapbook = new Chapbook("Durham Poems", "Poems on William Denton, years 1823–1842", ["Benjamin", "Laird"], "./images/erectingshop.png", {"quote" : "A poem is a small (or large) machine made of words.", "author" : "Williams"}, 15);

		//randomise the secondary headings?
		//Poems on the Machinery of the Nineteenth Century

		//new poems - move poems to a json file?
		poetryChapbook.addPoem(new Poem("A Coat without Buttons", 
								["Young Denton", "ascetic fever", "Quaker-like", "what need", "for them", "a sensation", "practice of wearing", "master", "the situation", "despite", "the ridicule", "of worldlings"], 
								[]
								));
		poetryChapbook.addPoem(new Poem("The Methodist Library", 
								["“Saint’s Rest”", "“Pilgrim’s Progress”", "“The Methodist Magazine”", "him", "he", "books", "his taste", "Sunday School", "the Bible", "ritualism", "eight years", "avidity"], 
								["and volumes of", "were speaking", "figuratively", "swallowed", "with", "soon began", "a relish for", "attended", "recited", "reached", "assembled", "through", "was"]
								));

		poetryChapbook.addPoem(new Poem("Machinist", 
								["problem", "rule", "sphere", "cone", "frustum", "solidity", "product", "diameter", "read", "metallurgy", "find", "difference", "sum", "square"], 
								["÷", "¼", "30 pages", "+", "−", "×", "½", "10 pages", "of the", "of their", "will give the", "will be", "2 chapters", "being"]
								));

		poetryChapbook.addPoem(new Poem("Hammer in Hand", 
								["geologist’s hammer", "hand", "silver spoon", "poverty", "genius", "love", "honor", "germ-principle", "world", "denizen"], 
								["into", "with", "neither", "in", "indigenous to", "became", "of", "what of", "loosen", "to"]
								));

		poetryChapbook.addPoem(new Poem("Strata", 
								["granite", "metamorphic", "Cambrian", "Silurian", "Devonian", "Carboniferous", "Permian", "Secondary", "Tertiary", "Quaternary"], 
								["layered", "through", "on", "under", "over", "splitting", "excavating", "compressing", "ejecting", "leeching"]
								));
		poetryChapbook.addPoem(new Poem("Principles of Geology",
									["geology", "history", "doctrine", "connexions", "light", "lakes", "valleys", "mountains", "volcanoes", "physical sciences", "moral"],
									["compared to", "brought to", "as", "and", "is", "are", "can", "belonged to", "changed to", "related to", "acquainted with"]
									));
		poetryChapbook.addPoem(new Poem("Character is the Growth of Time", 
						["solid", "rock", "love", "beauty", "world", "ours", "battlefields", "fights", "Alpine peaks", "lives", "words", "compute"], 
						["as", "and", "devoid of", "utterly", "of", "forced into", "rise to", "is", "are", "can"]
						));
		poetryChapbook.addPoem(new Poem("Samson, Hercules and John Buddle", 
						["cylinders", "cast iron", "box-like frames", "valve gear", "pumps", "throttle", "reversing lever", "vertically", "parallel motion", "wheels", "slides", "axles", "brackets", "chilled tread"], 
						["fitted over", "resting on", "giving", "assembled", "guided by", "fixed upon", "bolted to", "renewed", "with a", "capacity of", "working", "rivetted to", "attached", "reduced to"]
						));
		poetryChapbook.addPoem(new Poem("A New Teacher, William Shotton", 
						["rara avis", "phrenology", "electricity", "Baptist", "practical lessons", "religious subjects", "his lips", "galvanic battery", "revolution", "soul", "students"], 
						["and", "conclusions on", "working within", "experiments with", "his own", "making", "anti-methodistic", "delighted to", "listening", "impressing", "marvelled at"]
						));
		poetryChapbook.addPoem(new Poem("Mr Hackworth’s Shildon", 
						["Mr Hackworth", "file", "New Shildon", "superintendent", "locomotive", "Soho", "Stockton", "Darlington", "Conscience!", "employer", "railway", "machinery"], 
						["&", "small regard for", "the old", "living in", "to be a", "as fine as a", "repair some", "go", "via", "told", "is not", "talked of", "returned"]
						));

		poetryChapbook.addPoem(new Poem("Currier", 
						["paid", "half-crown", "week", "eleven years old", "earn", "distaste", "hired", "wages", "foreman", "boy", "independent", "work", "business", "spirit", "genius"], 
						["flung", "considered", "little account", "privilege of", "accomplished", "at the", "a", "for", "and", "valiantly", "growing", "but not the", "with the", "used to"]
						));

		poetryChapbook.addPoem(new Poem("The Spirit of Reform", 
						["old Methodist society", "a split", "debate", "his powers", "the devil", "the disguise", "commotion", "multitudes", "rule", "authority", "Popery", "nothing", "a voice", "the church", "the religious world"], 
						["in", "wore", "stirred up", "grew tired of", "of", "and", "better than", "have", "hence", "desired", "excited", "to them", "had", "was", "sides with"]
						));

		poetryChapbook.addPoem(new Poem("Joseph Barker", 
						["Gospel", "Christianity", "religion", "Christ", "questions", "observations", "triumphant", "Socialism", "Socialists", "society", "good", "evil", "New Testament", "who", "principled", "what"], 
						["is", "professes", "advocates", "exposes", "charges", "of", "tendency of", "had", "increases", "itself", "opening the", "the true", "considers", "their", "our", "quote", "manifests"]
						));
		poetryChapbook.addPoem(new Poem("Methodist-minister-grocer", 
						["Methodist world", "Lord’s chosen vessel", "unsound", "dishonesty", "cheating", "false", "weight", "lead", "scale", "the public", "example", "morals", "piece"], 
						["was", "chosen", "on", "denounced", "injurious", "adding", "as", "strictly", "is", "eschewed", "not", "with", "placing"]
						));
		poetryChapbook.addPoem(new Poem("Man Considered as a Physical Being", 
						["human", "mind", "body", "bones", "muscles", "nerves", "bloodvessels", "nutrition", "respiration", "thought", "mechanical", "science", "principle", "physical", "creation", "Creator", "man"], 
						["consists of", "organs of", "in harmony with", "law of", "perfect", "constructed on", "and", "infringement of", "with", "on", "pursuing", "bestowed by", "arrive at", "prosecuted in", "incomplete", "beside", "adaption of", "in relation to", "influence"]
						));
		poetryChapbook.addPoem(new Poem("Man Considered as an Organised Being", 
						["organic", "laws", "food", "first", "obedience", "the earth", "harmony", "mode", "choice", "pleasure", "pain", "death", "sleep", "health"], 
						["subsists on", "obeyed", "sowed", "producing", "supplying", "in", "frames",  "source of", "inflicted", "and", "if", "with", "has", "supplied with"]
						));



		// "The town I once knew has departed and a new town with the old name is here."
		// William Denton, Darlington, 25 December 1876

		poetryChapbook.prepareForPublication();

		var acknowledgements = {"text" : "I am grateful to the Wellesley Historical Society for access to the Denton family collection and especially to Kathleen Fahey for her time and invaluable assistance with the archive."}
		//convert to source object?? object types
		// add
		var sources = [
						{"document" : "Diary. 1839–1842", "collection" : "Denton family collection. Wellesley Historical Society", "authors" : [["Denton", "William"]]},
						];
		//sources chapbook or chapbook printer?
		var poetryChapbookPrinter = new ChapbookPrinter(poetryChapbook, {"name" : "The Code of Things", "url" : "thecodeofthings.com"}, "Melbourne", "Australia", acknowledgements);

		//image sourced from http://collectionscanada.gc.ca/pam_archives/index.php?fuseaction=genitem.displayItem&rec_nbr=3391580 and no longer in copyright
		var postImageSrc = "./images/samson.jpg";
		// use image objects?
		// preloader //add cover image here and move to chapbook?
		//var preImage = new Image();
		//var postImage = new Image();
		//preImage.src = poetryChapbook.image;
		//postImage.src = postImageSrc;

		var poetryChapbookReader = new ChapbookReader(poetryChapbookPrinter);

		//window.onresize = function() {
		//	poetryChapbookReader.updateWindow();  //put this somewhere?
		//}
		//put somewhere sensible -- kick on orientation change
		window.addEventListener('resize', function () {
			poetryChapbookReader.updateWindow();  //put this somewhere?
		});
		window.addEventListener('orientationchange', function () {
			poetryChapbookReader.updateWindow();  //put this somewhere?
		});

		//d3.select("#title").text("The " + poetryChapbook.title); //add this in properly

		//initPrinting() ?
		poetryChapbookPrinter.addPage("page-1", true); // move this to printer
		poetryChapbookPrinter.addPage("page-2"); // move this to printer


		poetryChapbookPrinter.updatePublishingCity();

		poetryChapbookReader.updateWindow();
	
		//move to chapbookreader
		if (!poetryChapbookReader.isFullscreenEnabled()) {
			d3.select("#fullscreen").remove();
		}
		//window.setTimeout(function() { printChapbook(); }, 5000 );
		printChapbook();


		//move to chapbook reader -- initReading?
		function printChapbook() {
			//change loading to printing
			d3.select("#loading").remove();
			
			//add move to set up controllers / page turners
			d3.select("body").on("wheel", 
				function() { poetryChapbookReader.pageScroll(); }
				);
			d3.select("#next-page").on("click", 
				function() { poetryChapbookPrinter.nextPage(); }
				);
			d3.select("#previous-page").on("click", 
				function() { poetryChapbookPrinter.previousPage(); }
				);

			d3.select("#controls-switch").on("click", 
				function() { poetryChapbookReader.toggleControls(); }
				);

			//make sure the buttons contain the correct disabled/enabled state (possible bug?)
			d3.select("#play-pause").on("click", 
				function() { poetryChapbookReader.playPauseReading(); }
				).attr("disabled", null);

			d3.select("#about").on("click", 
				function() { poetryChapbookReader.aboutChapbook(); }
				).attr("disabled", null);
			d3.select("#share").on("click", 
				function() { poetryChapbookReader.shareChapbook(); }
				).attr("disabled", null);


			//disable mode change during transition ... if so renable during play?
			d3.select("#single-page").on("click", 
				function() { 
					poetryChapbookPrinter.singlePageMode(); 
					poetryChapbookReader.updateWindow();
				}
				).attr("disabled", null);
			d3.select("#double-page").on("click", 
				function() { 
					poetryChapbookPrinter.doublePageMode(); 
					poetryChapbookReader.updateWindow();
				}
				).attr("disabled", "disabled");

			d3.select("#fullscreen").on("click", 
				function() { poetryChapbookReader.toggleFullScreen(); }
				).attr("disabled", null);
			d3.select("#next-control").on("click", 
				function() { poetryChapbookPrinter.nextPage(); }
				).attr("disabled", null);
			d3.select("#previous-control").on("click", 
				function() { poetryChapbookPrinter.previousPage(); }
				).attr("disabled", null);


			/* render initial pages */

			poetryChapbookPrinter.tabulaRasa("#page-1", 0);
			poetryChapbookPrinter.tabulaRasa("#page-1", 1);

			poetryChapbookPrinter.printPreTitlePage("#page-2");
			//poetryChapbookPrinter.printCoverPage("#page-2");
			poetryChapbookPrinter.printImagePage("#page-2");
		}

		

		</script>

	</body>
</html>